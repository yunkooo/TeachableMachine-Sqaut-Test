<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link type="text/css" rel="stylesheet" href="css/login/materialize.min.css"  media="screen,projection"/>
    <link rel="stylesheet" href="css/login/custom.css">
    <link rel="stylesheet" href="css/bootstrap.css">
    <link rel="stylesheet" href="css/navbar/sidevar.css">
    <link href="https://fonts.googleapis.com/css2?family=Oswald&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Lato&display=swap" rel="stylesheet">
    <script src="https://kit.fontawesome.com/a076d05399.js"></script>


    <title>squat</title>
</head>
<body>

  <input type="checkbox" id="active">
  <label for="active" class="menu-btn"><span></span></label>
  <label for="active" class="close"></label>
  <div class="wrapper">
    <ul>
      <li><a href="index.html">Home</a></li>
      <li><a id = "loginmenu" href="login.html">Login</a></li>
      <li><a href="squat.html">Squat</a></li>
      <li><a href="#">Record</a></li>
      <li><a href="#">Mypage</a></li>
    </ul>
  </div>
  <br>
  <br>
  <br>
  <div id="dvAuth">
    <div id="dvLogin">
    <div id="Join">
      <br>
      <br>
        <input type="text" id="name" name="userName" class="input-text" placeholder="이름">
        <input type="email" id="email" name="userEmail" class="input-text" placeholder="이메일 아이디">
        <input type="password" id="pwd" name="password" class="input-text" maxlength="17" placeholder="비밀번호">
        <input type="text" id="height" name="height" class="input-text" placeholder="키">
        <input type="text" id="weight" name="weight" class="input-text" placeholder="몸무게">

        <!-- <input type="password" id="joinRePassword" class="input-text" maxlength="17" placeholder="비밀번호 확인"> -->
        <ul class="btnGroup">
            <li id="liEmailJoinSubmit" class="waves-effect waves-teal btn-flat emailjoin">이메일으로 가입</li>
        </ul>
    </div>
    </div>
  </div>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script type="text/javascript" src="js/bootstrap.js"></script>

  <script src="https://www.gstatic.com/firebasejs/8.6.5/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.6.5/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.6.5/firebase-firestore.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.6.5/firebase-storage.js"></script>
  <script src="https://www.gstatic.com/firebasejs/4.10.1/firebase.js"></script>


  <script>
    var firebaseEmailAuth;
    var firebaseDatabase;
    var userInfo;

    const firebaseConfig = {
        apiKey: "AIzaSyCgxgXoIvYsy0jqugTu_mBpy1OspsaUGCg",
        authDomain: "test-900db.firebaseapp.com",
        databaseURL: "https://test-900db-default-rtdb.firebaseio.com",
        projectId: "test-900db",
        storageBucket: "test-900db.appspot.com",
        messagingSenderId: "668651633244",
        appId: "1:668651633244:web:fad0f4735eda521c558499",
        measurementId: "G-H42PPWY24J"
    };
  
    // Initialize Firebase
    firebase.initializeApp(firebaseConfig) 

    firebaseEmailAuth = firebase.auth();
    firebaseDatabase = firebase.database();

    //제이쿼리 
  $(document).ready(function(){
  
  //가입버튼 눌렀을 때 작동하는 함수
    $(document).on('click','.emailjoin',function(){
 
    //jquery를 이용해서 입력된 값을 가져온다.  
      var email = $('#email').val();
      var password = $('#pwd').val();
      name = $('#name').val();
      userEmail = $('#email').val();
      height = $('#height').val();
      weight = $('#weight').val();
      
//이메일로 가입 버튼 눌렀을 때 작동되는 함수 - firebase 인증 모듈
  firebaseEmailAuth.createUserWithEmailAndPassword(email, password).then(function(user) {
    
    userInfo = user; //가입 후 callBack 함수로 생성된 유저의 정보가 user에 담겨서 넘어온다. 전역변수에 할당.
 
    //뭐가 찍히는지 직접 체크해보세요.
    console.log("userInfo/"+userInfo); //오브젝트 타입
    console.log("userInfo.currentUser/"+userInfo.currentUser); //안됨
    console.log("userInfo.uid/"+userInfo.uid); //vPArtCHqPpOeIOpidEfug0Kgq3v1
    console.log(name)
    //성공했을 때 작동되는 함수
    logUser(); 
 
  }, function(error) {
    //에러가 발생했을 때 
    var errorCode = error.code;
    var errorMessage = error.message;
    alert(errorMessage);
   
  });
 
  //가입 성공했을 때 호출 되는 함수 - 위의 firebase의 인증 모듈과 다른 database 모듈임을 확인하자.
  function logUser(){
    var ref = firebaseDatabase.ref("users/"+userInfo.uid); //저장될 곳을 users라는 부모 키를 레퍼런스로 지정.
    
    //저장 형식
    var obj = {
        name: name,
        email: userEmail,
        height: height,
        weight: weight,

    };

    ref.set(obj); // 고유한 자식 키가 하나 생셩이 되면서 json 삽입
    alert("가입성공");
 
    //메인 페이지로 이동시키고 세션 저장시키기
    window.location.href = "/index.html"
}
 
 
  });
});
     
    

 </script>

</body>
</html>